<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-02-15 mer. 22:30 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Peaceful 2048</title>
<meta name="author" content="DUREL Enzo DUREL Enzo / VILLEPREUX Thibault" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="https://hozendev.github.io/hozen-style/reset.css" />
<link rel="stylesheet" type="text/css" href="https://hozendev.github.io/hozen-style/hozen_style.css" />
<script src="https://hozendev.github.io/hozen-style/scripts/toc.js"></script>
<script src="https://hozendev.github.io/hozen-style/scripts/widget.js"></script>
<script src="https://hozendev.github.io/hozen-style/scripts/theme.js"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Peaceful 2048</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org6412d74">1. Introduction</a>
<ul>
<li><a href="#org3d3aa7f">1.1. Mode d'emploi</a></li>
<li><a href="#org2606a42">1.2. Disposition des fichiers</a></li>
</ul>
</li>
<li><a href="#org4b403cb">2. Ressources</a>
<ul>
<li><a href="#orgf54de5a">2.1. Bibliothèques</a>
<ul>
<li><a href="#org4f27cd9">2.1.1. Standard</a></li>
<li><a href="#org1ab4d1c">2.1.2. SDL 1.2</a></li>
<li><a href="#org23c208a">2.1.3. Installations</a></li>
</ul>
</li>
<li><a href="#org0ddc387">2.2. Musiques</a></li>
<li><a href="#org4ebe7b6">2.3. Images</a></li>
<li><a href="#orge82a11f">2.4. Fonts</a></li>
</ul>
</li>
<li><a href="#org0333ffc">3. Modélisation</a>
<ul>
<li><a href="#org432f81f">3.1. Structures</a>
<ul>
<li><a href="#orgdb1f70c">3.1.1. Map</a></li>
<li><a href="#org9989edc">3.1.2. Tileset</a></li>
<li><a href="#org0216cb3">3.1.3. TileProp</a></li>
</ul>
</li>
<li><a href="#org9a8d7f4">3.2. Fonctions principales</a>
<ul>
<li><a href="#org75abf2c">3.2.1. Mouvements</a></li>
<li><a href="#org4b34af1">3.2.2. Win &amp; Lose</a></li>
<li><a href="#org71306e8">3.2.3. Menu</a></li>
<li><a href="#orge441242">3.2.4. Scores</a></li>
<li><a href="#orgcd685db">3.2.5. Chronomètre</a></li>
<li><a href="#orga19f0f0">3.2.6. Sauvegarde</a></li>
<li><a href="#org3b5be31">3.2.7. Musique</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orga76d0f9">4. Améliorations potentielles</a>
<ul>
<li><a href="#org8eaec3e">4.1. Déplacement et Rotation</a></li>
<li><a href="#orgbec0696">4.2. Chronomètre</a></li>
<li><a href="#org2e13cab">4.3. Fonctionnalitées dans le menu</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org6412d74" class="outline-2">
<h2 id="org6412d74"><span class="section-number-2">1.</span> Introduction</h2>
<div class="outline-text-2" id="text-1">

<div id="org6d0fc52" class="figure">
<p><img src="./img/screen_1.png" alt="screen_1.png" />
</p>
<p><span class="figure-number">Figure 1: </span>Capture d'écran du jeu</p>
</div>
</div>

<div id="outline-container-org3d3aa7f" class="outline-3">
<h3 id="org3d3aa7f"><span class="section-number-3">1.1.</span> Mode d'emploi</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Nous avons réalisé un 2048 jouable en console et en interface graphique. Le choix
du mode de jeu se fait dans le terminal après le lancement du programme. Si vous
choisissez la version graphique, vous pouvez également choisir la taille de la grille
(3*3, 4*4, 5*5).
</p>

<p>
Pour la version console les déplacements sont expliqués dans le terminal. Et dans la
version graphique, vous pouvez vous déplacer avec les flèches du clavier et revenir d'une
grille en arrière avec la touche 'a'.
</p>

<p>
De plus, vous disposez d'un menu en faisant "Echap". Dedans, vous avez la possibilité
de :
</p>
<ul class="org-ul">
<li>relancer une nouvelle partie ;</li>
<li>de sauvegarder la grille actuelle (choix aussi possible à chaque fermeture du programme) ;</li>
<li>de charger une partie précédemment sauvegardée ;</li>
<li>afficher les contrôles disponibles pour le jeu ;</li>
<li>de quitter le jeu (possible également avec la croix rouge classique) ;</li>
</ul>

<p>
Également, la version en console est un prototype, réalisé avant la SDL. Il ne dispose pas
de structure, la taille est modifiable en dur (#define N x : avec x ma taille de la
grille) et il n'est pas optimisé contrairement à la SDL. Néanmoins, il n'y a pas de temps
de calcul gênant l'utilisation (seulement un petit temps de chargement au début avec la
fonction "sleep" pour afficher les règles).
</p>
</div>
</div>

<div id="outline-container-org2606a42" class="outline-3">
<h3 id="org2606a42"><span class="section-number-3">1.2.</span> Disposition des fichiers</h3>
<div class="outline-text-3" id="text-1-2">
<p>
Vous avez à votre disposition dans le fichier compressé :
</p>
<ul class="org-ul">
<li>un répertoire "code" contenant l'ensemble de nos codes et de nos en-têtes (console et SDL),</li>
<li>un répertoire "data" contenant les caractéristiques des maps (choix des blocs, tailles&#x2026;) et les meilleurs scores suivant la taille de grille choisie,</li>
<li>un répertoire "fonts" contenant la police d'écriture pour TTF,</li>
<li>un répertoire "graphics" contenant l'image en background et les images des blocs (images créées pour le jeu),</li>
<li>un répertoire "music" contenant la musique du fond et le son pour chaque déplacement (musiques créées aussi pour le jeu)</li>
<li>une version de notre jeu déjà compilé,</li>
<li>un Makefile permettant de recompiler notre projet,</li>
<li>un fichier "save.txt" permettant la sauvegarde d'une unique partie.</li>
</ul>

<p>
Pour une meilleure correction, nous avons fait le choix de rendre ces dossiers/fichiers visibles.
</p>
</div>
</div>
</div>

<div id="outline-container-org4b403cb" class="outline-2">
<h2 id="org4b403cb"><span class="section-number-2">2.</span> Ressources</h2>
<div class="outline-text-2" id="text-2">
<p>
Voici les ressources utilisées dans notre projet.
</p>

<pre class="example" id="orgcb9e01d">
Attention : des bibliothèques sont à installer pour faire fonctionner notre
programme. Il s'agit de bibliothèque appartenant à la SDL 1.2
</pre>
</div>

<div id="outline-container-orgf54de5a" class="outline-3">
<h3 id="orgf54de5a"><span class="section-number-3">2.1.</span> Bibliothèques</h3>
<div class="outline-text-3" id="text-2-1">
</div>
<div id="outline-container-org4f27cd9" class="outline-4">
<h4 id="org4f27cd9"><span class="section-number-4">2.1.1.</span> Standard</h4>
<div class="outline-text-4" id="text-2-1-1">
<p>
Liste des bibliothèques utilisées :
</p>
<ul class="org-ul">
<li><code>stdio.h</code></li>
<li><code>stdlib.h</code></li>
<li><code>sys/stat.h</code></li>
<li><code>time.h</code></li>
<li><code>string.h</code></li>
</ul>
</div>
</div>

<div id="outline-container-org1ab4d1c" class="outline-4">
<h4 id="org1ab4d1c"><span class="section-number-4">2.1.2.</span> SDL 1.2</h4>
<div class="outline-text-4" id="text-2-1-2">
<p>
Liste des bibliothèques utilisées :
</p>
<ul class="org-ul">
<li><code>SDL/SDL.h</code></li>
<li><code>SDL/SDL_image.h</code></li>
<li><code>SDL/SDL_ttf.h</code></li>
<li><code>SDL/SDL_mixer.h</code></li>
</ul>
</div>
</div>

<div id="outline-container-org23c208a" class="outline-4">
<h4 id="org23c208a"><span class="section-number-4">2.1.3.</span> Installations</h4>
<div class="outline-text-4" id="text-2-1-3">
</div>
<ol class="org-ol">
<li><a id="org5352f63"></a>SDL 1.2<br />
<div class="outline-text-5" id="text-2-1-3-1">
<div class="org-src-container">
<pre class="src src-bash">sudo apt-get install libsdl1.2-dev
</pre>
</div>
</div>
</li>

<li><a id="orge706a89"></a>SDL IMAGE<br />
<div class="outline-text-5" id="text-2-1-3-2">
<div class="org-src-container">
<pre class="src src-bash">sudo apt-get install libsdl-image1.2 libsdl-image1.2-dev
</pre>
</div>
</div>
</li>

<li><a id="org7152004"></a>SDL TTF<br />
<div class="outline-text-5" id="text-2-1-3-3">
<div class="org-src-container">
<pre class="src src-bash">sudo apt-get install libsdl-ttf2.0-dev
</pre>
</div>
</div>
</li>

<li><a id="orge064508"></a>SDL MIXER (audio)<br />
<div class="outline-text-5" id="text-2-1-3-4">
<div class="org-src-container">
<pre class="src src-bash">sudo apt-get install libsdl-mixer1.2-dev
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-org0ddc387" class="outline-3">
<h3 id="org0ddc387"><span class="section-number-3">2.2.</span> Musiques</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Le thème principal a été composé par Enzo Durel qui se réserve tous les droits liés à son
utilisation. Le logiciel utilisé a été FL-Studio 20.
</p>

<p>
Les sons d'introduction et de déplacements ont été choisi sur <a href="https://freesound.org">FreeSound</a> et sont libres de
droits.
</p>
</div>
</div>

<div id="outline-container-org4ebe7b6" class="outline-3">
<h3 id="org4ebe7b6"><span class="section-number-3">2.3.</span> Images</h3>
<div class="outline-text-3" id="text-2-3">
<p>
Toute la charte graphique a été créée par Enzo Durel qui se réverse tout les droits
liés à son utilisation. Les logiciels utlisés ont été Photoshop et Krita.
</p>
</div>
</div>

<div id="outline-container-orge82a11f" class="outline-3">
<h3 id="orge82a11f"><span class="section-number-3">2.4.</span> Fonts</h3>
<div class="outline-text-3" id="text-2-4">
<p>
La police a été choisie sur <a href="https://www.dafont.com">DaFont</a> et est une police libre de droits.
</p>
</div>
</div>
</div>

<div id="outline-container-org0333ffc" class="outline-2">
<h2 id="org0333ffc"><span class="section-number-2">3.</span> Modélisation</h2>
<div class="outline-text-2" id="text-3">
<p>
Dans cette partie nous expliquerons le fonctionnement du code.
</p>

<p>
Notre implémentation du code en SDL se base sur le concept de Tile Mapping, un concept
très répandu et utilisé dans les années 90 dans le jeu vidéo 2D.
</p>
</div>

<div id="outline-container-org432f81f" class="outline-3">
<h3 id="org432f81f"><span class="section-number-3">3.1.</span> Structures</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Disponible à <code>projet2048/code/headers/struct.h</code>.
</p>
</div>

<div id="outline-container-orgdb1f70c" class="outline-4">
<h4 id="orgdb1f70c"><span class="section-number-4">3.1.1.</span> Map</h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
La structure <code>Map</code> correspond au plateau de jeu du 2048. Elle est composée :
</p>
<ul class="org-ul">
<li>D'un <code>schema</code> (char **) (tableau de caractères 2D) représentant le plateau de jeu du 2048</li>
<li>D'une largeur <code>w</code> (int) (largeur du schéma)</li>
<li>D'une hauteur <code>h</code> (int) (hauteur du schéma)</li>
<li>D'un <code>score</code> (int) (score actuel de la partie correspondant à la partie en cours)</li>
<li>D'un <code>Tileset</code> (Tileset *) (ressources graphiques des cases)</li>
</ul>
</div>
</div>

<div id="outline-container-org9989edc" class="outline-4">
<h4 id="org9989edc"><span class="section-number-4">3.1.2.</span> Tileset</h4>
<div class="outline-text-4" id="text-3-1-2">
<p>
La structure <code>Tileset</code> est la représentation en code d'une image contenant plusieurs
tiles (= représentation graphique d'un élément), par exemple ici, chaque nombre du
2048 (0, 2, 4, 8, 16, &#x2026;).
</p>

<p>
La structure est composée :
</p>
<ul class="org-ul">
<li>D'une largeur <code>w</code> (int) (nombre de tiles représentées et découpées en colonnes)</li>
<li>D'une hauteur <code>h</code> (int) (nombre de tiles représentées et découpées en lignes)</li>
<li>D'une résolution <code>res</code> (int) (32 px, 64 px, &#x2026;) (elle sera calculée par largeur<sub>de</sub><sub>l</sub><sub>image</sub>/largeur<sub>du</sub><sub>tileset</sub>)</li>
<li>D'une image <code>im</code> (SDL_Surface *)</li>
<li>Et d'un tableau de propriétés de tiles <code>props</code> (TileProp *)</li>
</ul>
</div>
</div>

<div id="outline-container-org0216cb3" class="outline-4">
<h4 id="org0216cb3"><span class="section-number-4">3.1.3.</span> TileProp</h4>
<div class="outline-text-4" id="text-3-1-3">
<p>
TileProp est une structure de propriétés de chaque tile.
</p>

<p>
Ici les tiles sont caractérisées par :
</p>
<ul class="org-ul">
<li>Une dimension <code>R</code> (SDL_Rect) (les coordonnées dans le tileset ainsi qu'une largeur et hauteur)</li>
<li>Une collision <code>plein</code> (int) (si le tile en question est "<b>plein</b>" ou "<b>vide</b>")</li>
<li>Une valeur associées <code>value</code> (int) (tile<sub>0</sub> = 0, tile<sub>1</sub> = 2, tile<sub>2</sub> = 4, &#x2026;) représentant les
puissances de 2 du jeu</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org9a8d7f4" class="outline-3">
<h3 id="org9a8d7f4"><span class="section-number-3">3.2.</span> Fonctions principales</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Le code présente de nombreuses fonctions mais attardons nous sur celles qui semblent
intéressantes :
</p>
</div>

<div id="outline-container-org75abf2c" class="outline-4">
<h4 id="org75abf2c"><span class="section-number-4">3.2.1.</span> Mouvements</h4>
<div class="outline-text-4" id="text-3-2-1">
<p>
Disponible à <code>projet2048/code/src/move.c</code>.
</p>

<p>
Le mouvement du plateau de jeu est basé sur deux principes : un unique déplacement et
la rotation du plateau.
</p>
</div>

<ol class="org-ol">
<li><a id="orgac07ee2"></a>Droit<br />
<div class="outline-text-5" id="text-3-2-1-1">
<br>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #93EBB9;">void</span> <span style="color: #fa8072;">droit</span>(<span style="color: #93EBB9;">Map</span> * <span style="color: #E8E3BA;">m</span>);  
</pre>
</div>

<p>
L'unique déplacement ici est sur le coup <code>droit</code> <b>(de gauche à droite)</b>. Il aurait pu
être basé sur n'importe quel autre mouvement.
</p>

<p>
Le plateau de jeu représenté étant un tableau 2D de caractères nous avons défini les cases
vides comme étant les <code>0</code>.
Le déplacement se fait donc en 3 phases :
</p>
<ul class="org-ul">
<li>On <b>"comble"</b> les <code>0</code>, c'est-à-dire on range les cases le plus à droite possible sans
comparaison de valeurs</li>
<li>On <b>"fusionne"</b> les cases : On ajoute les cases adjacentes avec les valeurs
équivalentes en commençant par la case la plus à droite (en regardant les cases à
droite de celle-ci). Cet ordre est défini par le jeu du 2048, si des cases sont
équivalentes, celles dans la direction donnée fusionnent en premières.</li>
<li>On <b>"recomble"</b> les <code>0</code> pour enlevés les espaces crées lors de la phase de fusion.</li>
</ul>

<br>
</div>
</li>

<li><a id="org5f4435f"></a>Rotation<br />
<div class="outline-text-5" id="text-3-2-1-2">
<br>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #93EBB9;">void</span> <span style="color: #fa8072;">rota_droite</span>(<span style="color: #93EBB9;">char</span> ** <span style="color: #E8E3BA;">schema</span>, <span style="color: #93EBB9;">int</span> <span style="color: #E8E3BA;">n</span>);
</pre>
</div>

<p>
Maintenant que nous avons conçu notre déplacement pour une direction, j'imagine qu'il
paraît évident et facile de faire les autres&#x2026; et bien nous n'allons pas le faire.
</p>

<p>
En effet, par la suite chaque mouvement sera fait par le mouvement droit mais
le tableau fera des rotations.
</p>

<p>
Pour m'expliquer, le mouvement haut est un mouvement droit pour le tableau droit
tourné à 90° dans le sene anti-horaire. Et de même pour les autres deplacements.
</p>

<p>
Ici, nous s'utiliserons seulement la rotation à <code>90°</code> dans le sens horaire.
</p>

<p>
La rotation se fait en 2 étapes :
</p>
<ul class="org-ul">
<li>Transformation des lignes en colonnes (transposée).</li>
<li>Inversions des colonnes.</li>
</ul>

<p>
Cette façon est donc élégante mais plus lente que le déplacement rectiligne. Mais
dans le contexte du 2048, nous pensons que cela ne se ressent pas même sur une machine
avec très peu de ressources.
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-org4b34af1" class="outline-4">
<h4 id="org4b34af1"><span class="section-number-4">3.2.2.</span> Win &amp; Lose</h4>
<div class="outline-text-4" id="text-3-2-2">
<p>
Disponible à <code>projet2048/code/src/game_over.c</code>.
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #93EBB9;">int</span> <span style="color: #fa8072;">win</span>(<span style="color: #93EBB9;">Map</span> * <span style="color: #E8E3BA;">m</span>);
<span style="color: #93EBB9;">int</span> <span style="color: #fa8072;">lose</span>(<span style="color: #93EBB9;">Map</span> * <span style="color: #E8E3BA;">m</span>);
</pre>
</div>

<p>
Les fonctions des Victoire et de Défaite sont de simples parcours de tableau :
</p>
<ul class="org-ul">
<li>Pour la fonction <code>win</code> :
<ul class="org-ul">
<li>Parcours du tableau : s'il y a un 2048 : le joueur gagne (le droit de continuer)</li>
</ul></li>
<li>Pour la fonction <code>lose</code> :
<ul class="org-ul">
<li>Parcours du tableau et on regarde si chaque case n'est pas fusionnable avec celle
qui se situe relativement à celle-ci : en bas, et à droite. Si une case est vide bien
sur le joueur ne perd pas.</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org71306e8" class="outline-4">
<h4 id="org71306e8"><span class="section-number-4">3.2.3.</span> Menu</h4>
<div class="outline-text-4" id="text-3-2-3">
<p>
Disponible à <code>projet2048/code/src/menu.c</code>.
</p>

<p>
Passons maintenant à une fonction qui n'est pas essentielle au 2048 mais utile dans
le confort du joueur : le Menu.
</p>

<p>
Nous avons créé un menu "<b>dynamique</b>" :
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #93EBB9;">int</span> <span style="color: #fa8072;">menu</span>(<span style="color: #93EBB9;">SDL_Surface</span> * <span style="color: #E8E3BA;">screen</span>, <span style="color: #93EBB9;">char</span> * <span style="color: #E8E3BA;">str</span>, <span style="color: #93EBB9;">int</span> <span style="color: #E8E3BA;">transitions</span>);
</pre>
</div>

<p>
Il comporte toujours la même disposition, supporte jusqu'à 10 options maximum (choix
de notre part, car 10 options sur un menu c'est déjà trop&#x2026;). Chaque titre de menu et
chaque option peuvent être entièrement personnalisable.
</p>

<p>
<b>Fonctionnement :</b>
</p>

<p>
Le menu ne comporte que 3 paramètres :
</p>
<ul class="org-ul">
<li><code>SDL-Surface * screen</code> correspondant à l'écran de blittage.</li>
<li><code>char * str</code> correspondant à une phrase où sont listés, en premier : le titre,
ensuite les options : option 1, option 2 &#x2026; Chaque option est séparée par un
<code>|</code>. Exemple : "Menu|Nouvelle Partie|Charger|Quitter"</li>
<li><p>
un entier <code>transitions</code> correspondant à l'effet de fondu souhaité :
</p>
<ul class="org-ul">
<li><code>1</code> pour un fondu en entrée dans le menu</li>
<li><code>-1</code> pour un fondu en sortie de menu</li>
<li><code>2</code> pour les 2 fondus</li>
<li><code>0</code> pour aucun fondu.</li>
</ul>

<p>
Côté SDL, chaque option est incrémentée d'une SDL<sub>Surface</sub> et est modélisé par une police.
En s'aidant des flèches directionnelles, l'option se choisit tout en limitant au choix
minimum <code>1</code> jusqu'à l'option <code>n</code>.
</p>

<p>
La fonction retourne un entier correpondants à l'option choisie (sans compter le
titre) : <code>1</code> pour l'option 1, <code>2</code> pour l'option 2, &#x2026;
</p>

<p>
Nous avons donc juste à traiter l'option choisie dans un <code>switch</code>.
</p>

<p>
Grâce à cette unique fonction, nous avons créé tous les menus du jeu.
</p></li>
</ul>
</div>
</div>

<div id="outline-container-orge441242" class="outline-4">
<h4 id="orge441242"><span class="section-number-4">3.2.4.</span> Scores</h4>
<div class="outline-text-4" id="text-3-2-4">
<p>
Disponible à <code>projet2048/code/src/score.c</code>.
</p>
</div>

<ol class="org-ol">
<li><a id="org705596b"></a>Score En Cours<br />
<div class="outline-text-5" id="text-3-2-4-1">
<br>

<p>
Nous utilisons deux fonctions concernant le score de la partie :
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #93EBB9;">int</span> <span style="color: #fa8072;">score_load</span>(<span style="color: #93EBB9;">SDL_Surface</span> * <span style="color: #E8E3BA;">screen</span>, <span style="color: #93EBB9;">SDL_Surface</span> * <span style="color: #E8E3BA;">bg</span>, <span style="color: #93EBB9;">unsigned</span> <span style="color: #93EBB9;">long</span> <span style="color: #93EBB9;">int</span> <span style="color: #E8E3BA;">score</span>);  
</pre>
</div>

<p>
<code>ScoreLoad</code> qui étant donné un score en paramètre l'affiche sur l'écran. Elle prend
3 paramètres :
</p>

<ul class="org-ul">
<li><code>SDL_Surface * screen</code> l'écran principal.</li>
<li><code>SDL_Surface * bg</code> l'image de fond (background).</li>
<li><code>unsigned long int score</code> le score à afficher.</li>
</ul>

<p>
La fonction charge une police avec <code>SDL_ttf</code> sur une <code>SDL_Surface</code>. On calcule sa
taille, on crée en conséquence un <code>SDL_Rect</code> de la même taille que le texte et à la
position souhaitée. On coupe l'image de fond <code>bg</code> en sélectionnant l'endroit avec le
<code>SDL_Rect</code> crée précédemment puis ont le blit sur l'écran et on blit le score.
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #93EBB9;">int</span> <span style="color: #fa8072;">score_delete</span>(<span style="color: #93EBB9;">SDL_Surface</span> * <span style="color: #E8E3BA;">screen</span>, <span style="color: #93EBB9;">SDL_Surface</span> * <span style="color: #E8E3BA;">bg</span>, <span style="color: #93EBB9;">unsigned</span> <span style="color: #93EBB9;">long</span> <span style="color: #93EBB9;">int</span> <span style="color: #E8E3BA;">score</span>);
</pre>
</div>

<p>
<code>ScoreDelete</code> efface l'affichage actuel quand on remet à zéro. ScoreLoad ne pose
aucun problème d'affichage lors d'une partie car le score est une fonction croissante
donc un affichage toujours plus grand. Or quand on remet à 0, on doit effacer un
score car l'affichage avec 0 est forcément plus petit que le score de la partie
précédente.
</p>

<p>
La fonction est aussi utilisée lorsque le joueur revient au coup d'avant.
</p>

<br>
</div>
</li>

<li><a id="org8e1dfc3"></a>Score Max<br />
<div class="outline-text-5" id="text-3-2-4-2">
<br>

<p>
Nous utilisons deux fonctions pour gérer le score maximum d'un joueur :
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #93EBB9;">int</span> <span style="color: #fa8072;">score_max_save</span>(<span style="color: #93EBB9;">int</span> <span style="color: #E8E3BA;">mdj</span>, <span style="color: #93EBB9;">unsigned</span> <span style="color: #93EBB9;">long</span> <span style="color: #93EBB9;">int</span> <span style="color: #E8E3BA;">score</span>);
</pre>
</div>

<p>
<code>score_max_save</code> qui enregistre le score maximum dans le fichier correspondant. Elle
prend 2 paramètres :
</p>

<ul class="org-ul">
<li><code>int mdj</code> correspondant au mode de jeu en cours (3*3, 4*4, 5*5).</li>
<li><code>unsigned long int score</code> correspondant au score en cours.</li>
</ul>

<p>
La fonction ouvre le fichier <code>scoreX.txt</code> où X correspond au mode de jeu (3, 4, 5,
&#x2026;). Elle compare le score écrit dans le fichier au score passé en paramètre, si le
score est plus grand alors il remplace le score du fichier.
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #93EBB9;">int</span> <span style="color: #fa8072;">score_max_load</span>(<span style="color: #93EBB9;">SDL_Surface</span> * <span style="color: #E8E3BA;">screen</span>, <span style="color: #93EBB9;">SDL_Surface</span> * <span style="color: #E8E3BA;">bg</span>, <span style="color: #93EBB9;">int</span> <span style="color: #E8E3BA;">mdj</span>);
</pre>
</div>

<p>
<code>score_max_load</code> qui affiche le score max à l'écran. Même fonctionnement d'affichage
que <code>score_load</code>
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgcd685db" class="outline-4">
<h4 id="orgcd685db"><span class="section-number-4">3.2.5.</span> Chronomètre</h4>
<div class="outline-text-4" id="text-3-2-5">
<p>
Disponible à <code>projet2048/code/src/time.c</code>.
</p>

<p>
Nous utilisons une unique fonction pour la gestion du temps.
</p>

<p>
La gestion du temps n'est pas poussée dans ce jeu, nous affichons juste le temps depuis
le commencement de la partie. Le temps n'est pas sauvegardé.
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #93EBB9;">int</span> <span style="color: #fa8072;">chrono</span>(<span style="color: #93EBB9;">SDL_Surface</span> * <span style="color: #E8E3BA;">screen</span>, <span style="color: #93EBB9;">SDL_Surface</span> * <span style="color: #E8E3BA;">bg</span>, <span style="color: #93EBB9;">unsigned</span> <span style="color: #93EBB9;">long</span> <span style="color: #93EBB9;">int</span> <span style="color: #E8E3BA;">time_begin</span>);
</pre>
</div>


<p>
<code>chrono</code> affiche le temps écoulé depuis le lancement du programme, mais elle peut
aussi afficher le temps relatif à une partie. Elle a 3 paramètres :
</p>

<ul class="org-ul">
<li><code>SDL_Surface * screen</code> l'écran principal</li>
<li><code>SDL_Surface * bg</code> l'image de fond</li>
<li><code>unsigned long int time_begin</code> le temps de début relatifs</li>
</ul>

<p>
On utilise ici <code>SDL_GetTicks()</code> et on calcul les minutes avec le rapport <code>((SDL_GetTicks()-time_begin) / 60000)</code>
et les scondes avec <code>(((SDL_GetTicks()-time_begin) % 60000 )/ 1000)</code>
</p>

<p>
L'affichage se fait comme pour l'affichages des scores.
</p>

<p>
Pour afficher le temps en continue nous utilisons un <code>SDL_PollEvent</code> au lieu de
<code>SDL_WaitEvent</code> car ce dernier met en veille le programme donc n'actualise pas
l'affichage. Pour gérer le surplus de CPU de <code>SDL_PollEvent</code> nous endormons le
programme tant que <code>30ms</code> ne sont pas passées et qu'aucune touche n'est pressée.
</p>

<p>
Nous appelons donc <code>chrono</code> lors du processus d'endormissement, il fonctionne en parallèle.
</p>
</div>
</div>

<div id="outline-container-orga19f0f0" class="outline-4">
<h4 id="orga19f0f0"><span class="section-number-4">3.2.6.</span> Sauvegarde</h4>
<div class="outline-text-4" id="text-3-2-6">
<p>
Disponible à <code>projet2048/code/src/save.c</code>.
</p>

<p>
La sauvegarde n'est pas très avancée : nous pouvons ne charger qu'une unique
sauvegarde. De plus, si le mode de jeu en cours n'est pas compatible avec la sauvegarde
que l'on veut charger, alors un message d'erreur apparaît pour informer le joueur.
</p>

<p>
Nous utilisons deux fonctions pour gérer la sauvegarde :
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #93EBB9;">int</span> <span style="color: #fa8072;">sauv</span>(<span style="color: #93EBB9;">Map</span> * <span style="color: #E8E3BA;">m</span>, <span style="color: #93EBB9;">char</span> * <span style="color: #E8E3BA;">name</span>, <span style="color: #93EBB9;">int</span> <span style="color: #E8E3BA;">mdj</span>);
</pre>
</div>

<p>
<code>sauv</code> qui sauvegarde la partie : elle écrit dans le fichier <code>save.txt</code> le mode de jeu
sous la forme <code>#sauv X</code> où X est le mode de jeu (3, 4, 5, &#x2026;), écrit le tableau de
caractères dans le fichier et écrit le score correspondant.
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #93EBB9;">int</span> <span style="color: #fa8072;">charge_sauv</span>(<span style="color: #93EBB9;">Map</span> * <span style="color: #E8E3BA;">m</span>, <span style="color: #93EBB9;">char</span> * <span style="color: #E8E3BA;">name</span>, <span style="color: #93EBB9;">int</span> <span style="color: #E8E3BA;">mdj</span>);
</pre>
</div>

<p>
<code>charge_sauv</code> qui récupère la sauvegarde, gère si le mode de jeu est compatible, si
oui, actualise le schéma du plateau de jeu ainsi que le score.
</p>
</div>
</div>

<div id="outline-container-org3b5be31" class="outline-4">
<h4 id="org3b5be31"><span class="section-number-4">3.2.7.</span> Musique</h4>
<div class="outline-text-4" id="text-3-2-7">
<p>
Disponible à <code>projet2048/code/src/music.c</code>.
</p>

<p>
Nous gérons la musique avec 3 fonctions :
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #93EBB9;">Mix_Music</span> * <span style="color: #fa8072;">music_load</span>(<span style="color: #93EBB9;">char</span> * <span style="color: #E8E3BA;">name</span>);  
</pre>
</div>

<p>
<code>music_load</code> qui charge une musique destinée à être jouée en boucle.
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #93EBB9;">Mix_Chunk</span> * <span style="color: #fa8072;">chunk_load</span>(<span style="color: #93EBB9;">char</span> * <span style="color: #E8E3BA;">name</span>, <span style="color: #93EBB9;">int</span> <span style="color: #E8E3BA;">level</span>);
</pre>
</div>

<p>
<code>chunk_load</code> qui charge un son court : ici le son de mouvement.
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #93EBB9;">void</span> <span style="color: #fa8072;">play_chunk</span>(<span style="color: #93EBB9;">Mix_Chunk</span> * <span style="color: #E8E3BA;">son</span>);
</pre>
</div>

<p>
<code>play_chunk</code> qui joue le son court.
</p>

<p>
La gestion se fait avec <code>SDL_Mixer</code> et ses fonctions.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orga76d0f9" class="outline-2">
<h2 id="orga76d0f9"><span class="section-number-2">4.</span> Améliorations potentielles</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org8eaec3e" class="outline-3">
<h3 id="org8eaec3e"><span class="section-number-3">4.1.</span> Déplacement et Rotation</h3>
<div class="outline-text-3" id="text-4-1">
<p>
Chaque fois que nous faisons un déplacement (sauf à droite), nous faisant 4 rotations. 
Effectivement on a :
</p>

<ul class="org-ul">
<li>\(x\) appelle à <code>rota_droite</code> puis <code>droit</code> afin de faire le coup.</li>
<li>\(4-x\) appelle à <code>rota_droite</code> pour la remettre dans le bon sens.</li>
</ul>

<p>
Nous pouvons faire une fonction <code>rota_droite</code> et <code>rota_gauche</code> pour limiter l'appelle à
la fonction <code>rota_droite</code> et donc gagner en complexité de calcul et temporel.
</p>
</div>
</div>

<div id="outline-container-orgbec0696" class="outline-3">
<h3 id="orgbec0696"><span class="section-number-3">4.2.</span> Chronomètre</h3>
<div class="outline-text-3" id="text-4-2">
<p>
Nous pouvons ajouter le fait d'enregistrer le chronomètre dans un fichier en même temps
que la grille. Comme ça si le joueur souhaite relancer sa partie, il peut recupérer son
ancien temps.
</p>

<p>
Et donc également faire un enregistrement du meilleur temps (comme pour le meilleur
score).
</p>

<p>
Il serait intéressant de pouvoir afficher le nombre d'heures quand le programme a été
lancé depuis plus de 60 min.
</p>
</div>
</div>

<div id="outline-container-org2e13cab" class="outline-3">
<h3 id="org2e13cab"><span class="section-number-3">4.3.</span> Fonctionnalitées dans le menu</h3>
<div class="outline-text-3" id="text-4-3">
<p>
On peut rajouter la possibilité de connaître le nombre d'heures jouer depuis
l'installation du programme.
</p>

<p>
Et aussi la possibilité de configurer soit même ces touches (et gérer les conflits).
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: DUREL Enzo DUREL Enzo / VILLEPREUX Thibault</p>
<p class="date">Created: 2023-02-15 mer. 22:30</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
